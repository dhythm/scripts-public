# 実装計画

- [ ] 1. プロジェクト構造とコア機能のセットアップ

  - プロジェクトディレクトリ構造の作成
  - 必要な依存関係の設定
  - 基本的なインターフェースの定義
  - _要件: 1.1, 1.2_

- [ ] 2. コマンドライン引数の解析機能の実装

  - [ ] 2.1 コマンドライン引数パーサーの作成

    - 入力ディレクトリパラメータの処理
    - オプションパラメータ（API 選択、出力ディレクトリ、ファイルパターン）の処理
    - ヘルプテキストの実装
    - _要件: 2.1, 2.2, 2.3, 2.4_

  - [ ] 2.2 設定バリデーションの実装
    - 入力パラメータの検証
    - デフォルト値の設定
    - 出力ディレクトリの自動設定
    - _要件: 2.5_

- [ ] 3. ファイルシステム操作の実装

  - [ ] 3.1 ディレクトリスキャン機能の作成

    - 指定されたディレクトリから PDF ファイルの検索
    - ファイルパターンによるフィルタリング
    - ファイルメタデータの収集
    - _要件: 1.1, 1.2_

  - [ ] 3.2 ファイル出力機能の実装
    - 抽出されたテキストをファイルに保存
    - 出力ディレクトリの作成（必要な場合）
    - ファイル書き込みエラー処理
    - _要件: 1.4_

- [ ] 4. Google Cloud 認証の実装

  - [ ] 4.1 認証ヘルパーの作成

    - 環境変数からの認証情報の読み取り
    - 認証情報の検証
    - エラーメッセージの生成
    - _要件: 3.1, 3.2_

  - [ ] 4.2 Google Cloud API クライアントの初期化
    - Vision API クライアントの設定
    - Document AI クライアントの設定
    - クライアント選択ロジックの実装
    - _要件: 1.3, 2.2_

- [ ] 5. テキスト抽出機能の実装

  - [ ] 5.1 Vision API OCR 機能の実装

    - PDF ファイルの Vision API への送信
    - レスポンスの解析
    - テキスト抽出ロジック
    - _要件: 1.3_

  - [ ] 5.2 Document AI 処理機能の実装

    - PDF ファイルの Document AI への送信
    - レスポンスの解析
    - テキスト抽出ロジック
    - _要件: 1.3_

  - [ ] 5.3 抽出テキストの後処理
    - テキストのフォーマット
    - ページ情報の追加
    - メタデータの処理
    - _要件: 1.4_

- [ ] 6. エラー処理とリトライロジックの実装

  - [ ] 6.1 エラーハンドラーの作成

    - エラータイプの定義
    - エラーログ記録
    - ユーザーフレンドリーなエラーメッセージ
    - _要件: 3.3_

  - [ ] 6.2 リトライメカニズムの実装

    - 一時的なエラーの検出
    - 指数バックオフアルゴリズム
    - 最大リトライ回数の設定
    - _要件: 3.4_

  - [ ] 6.3 レート制限処理の実装
    - レート制限エラーの検出
    - スロットリングロジック
    - バックオフ戦略
    - _要件: 3.5_

- [ ] 7. 並行処理の実装

  - [ ] 7.1 並行処理キューの作成

    - 同時実行数の制限
    - タスクキューの管理
    - リソース使用量の制御
    - _要件: 4.1_

  - [ ] 7.2 進行状況表示の実装
    - 処理中のファイル情報の表示
    - 進行状況バーの実装
    - 残り時間の推定
    - _要件: 4.2_

- [ ] 8. パフォーマンス最適化

  - [ ] 8.1 API コール最適化の実装

    - バッチ処理の実装
    - リクエスト頻度の最適化
    - キャッシュメカニズムの検討
    - _要件: 4.3_

  - [ ] 8.2 パフォーマンスメトリクスの実装
    - 処理時間の測定
    - ファイル統計の収集
    - サマリーレポートの生成
    - _要件: 4.4_

- [ ] 9. メインアプリケーションロジックの実装

  - [ ] 9.1 アプリケーションクラスの作成

    - 処理フローの制御
    - コンポーネントの統合
    - 終了処理
    - _要件: 1.2, 1.6_

  - [ ] 9.2 ロギングシステムの実装
    - ログレベルの設定
    - フォーマット済みログ出力
    - エラーログの強化
    - _要件: 1.5, 3.3_

- [ ] 10. テストの実装

  - [ ] 10.1 ユニットテストの作成

    - 各コンポーネントのテスト
    - モックとスタブの実装
    - エッジケースのテスト
    - _要件: すべて_

  - [ ] 10.2 統合テストの作成
    - エンドツーエンドのワークフローテスト
    - エラーシナリオのテスト
    - パフォーマンステスト
    - _要件: すべて_
